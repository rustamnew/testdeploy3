import{l as A,m as S,q as h,s as I,x as E,y as F,z as L,g as _,c as O,u as l,k as y,f as w,b as a,w as p,F as R,o as x,a as r,A as f,n as T,B as P,C as H}from"./entry.BXnrCNv6.js";import{_ as J}from"./QInput.DANEc9tc.js";import{u as Q,a as G,b as K,c as M}from"./useNotification.CtrOdVra.js";import{_ as W}from"./QForm.BKwtjglm.js";import{_ as X,a as Y}from"./QCardSection.BqsXZTLj.js";import{u as Z}from"./vue.f36acd1f.D5qHZy9J.js";import"./data.CJNdPfil.js";import"./use-dark.D6NxtXU6.js";const D=A({name:"QToggle",props:{...Q,icon:String,iconColor:String},emits:G,setup(i){function m(u,o){const s=S(()=>(u.value===!0?i.checkedIcon:o.value===!0?i.indeterminateIcon:i.uncheckedIcon)||i.icon),e=S(()=>u.value===!0?i.iconColor:null);return()=>[h("div",{class:"q-toggle__track"}),h("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},s.value!==void 0?[h(I,{name:s.value,color:e.value})]:void 0)]}return K("toggle",m)}}),ee="http://localhost:3001";async function $(i,m){const u=E();F("access_token");async function o(){try{const e=await $fetch(`${ee}/api/${m}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i})});if(e.data.user.id)return u.guest=!1,u.user=e.data.user,u.access_token=e.access_token,u.authenticated=!0,e;throw new Error("user id not found! (response.data.user.id)")}catch{return!1}}function s(){return u.guest=!0,u.authenticated=!1,{username:"guest"}}return i.username==="guest"?s():o()}const te=r("h1",{class:"text-3xl mb-6"}," Вход ",-1),se={class:"flex justify-center w-[96%] mr-4"},oe={class:"flex flex-col sm:flex-row sm:flex-nowrap justify-between items-center mt-2"},ne=r("span",{class:"text-darkgray my-2"},"У Вас нет аккаунта? ",-1),le=r("h1",{class:"text-3xl mb-6"}," Регистрация ",-1),ae={class:"flex justify-center w-[96%] mr-4"},ue={class:"flex flex-col sm:flex-row sm:flex-nowrap justify-between items-center mt-4"},re=r("span",{class:"text-darkgray my-2"},"Есть аккаунт?",-1),ve={__name:"auth",setup(i){const m=L();Z({title:"Вход"});const u=[{message:"Сохранено",bgColor:"green",position:"bottom-right"},{message:"Ошибка авторизации",bgColor:"red",position:"bottom-right"}],o=_(null),s=_(null),e=_(!1),g=_(!1),d=_("login");async function k(){if(g.value=!0,e.value===!0){j();return}const c={username:o.value,password:s.value};await $(c,d.value)?(g.value=!0,m.push({path:"/"})):(M(u[1]),g.value=!1)}async function j(){(await $({username:"guest",password:"guest"},d.value)).username&&m.push({path:"/"})}function V(c){d.value=c}function N(c){c===!0?(o.value="guest",s.value="guest"):(o.value="",s.value=""),e.value=c}return(c,t)=>{const U=H,b=J,z=D,v=P,C=W,q=Y,B=X;return x(),O(R,null,[l(g)===!0?(x(),y(U,{key:0,color:"primary",size:"3em",class:"absolute top-2 left-4"})):w("",!0),a(B,{class:"w-4/5 mt-[10vh] sm:w-96 lg:mt-[20vh]"},{default:p(()=>[l(d)==="login"?(x(),y(q,{key:0},{default:p(()=>[te,a(C,{class:"q-gutter-md mb-4",onSubmit:k},{default:p(()=>[r("div",{class:T(l(e)?"disabled":"")},[a(b,{modelValue:l(o),"onUpdate:modelValue":t[0]||(t[0]=n=>f(o)?o.value=n:null),disable:!!l(e),filled:"",hint:"Логин",class:"mb-3",autocomplete:"username"},null,8,["modelValue","disable"]),a(b,{modelValue:l(s),"onUpdate:modelValue":t[1]||(t[1]=n=>f(s)?s.value=n:null),disable:!!l(e),filled:"",type:"password",hint:"Пароль",autocomplete:"password"},null,8,["modelValue","disable"])],2),a(z,{modelValue:l(e),"onUpdate:modelValue":[t[2]||(t[2]=n=>f(e)?e.value=n:null),t[3]||(t[3]=(n,ie)=>N(n))],label:"Войти как гость"},null,8,["modelValue"]),r("div",se,[a(v,{label:"Войти",type:"submit",color:"primary"})])]),_:1}),r("div",oe,[ne,a(v,{flat:"",size:"md",label:"Зарегистрируйтесь",color:"primary",onClick:t[4]||(t[4]=n=>V("register"))})])]),_:1})):w("",!0),l(d)==="register"?(x(),y(q,{key:1},{default:p(()=>[le,a(C,{class:"q-gutter-md",onSubmit:k},{default:p(()=>[r("div",null,[a(b,{modelValue:l(o),"onUpdate:modelValue":t[5]||(t[5]=n=>f(o)?o.value=n:null),disable:!!l(e),filled:"",hint:"Логин"},null,8,["modelValue","disable"]),a(b,{modelValue:l(s),"onUpdate:modelValue":t[6]||(t[6]=n=>f(s)?s.value=n:null),disable:!!l(e),filled:"",type:"password",hint:"Пароль"},null,8,["modelValue","disable"])]),r("div",ae,[a(v,{label:"Зарегистрироваться",type:"submit",color:"primary"})])]),_:1}),r("div",ue,[re,a(v,{flat:"",size:"md",label:"Войти",color:"primary",onClick:t[7]||(t[7]=n=>V("login"))})])]),_:1})):w("",!0)]),_:1})],64)}}};export{ve as default};
